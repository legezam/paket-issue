FROM --platform=$BUILDPLATFORM mcr.microsoft.com/dotnet/sdk:8.0-jammy AS build-env

RUN apt-get update && apt-get install -y wget xz-utils git

# Installing Node

ARG NODE_VERSION=20.13.1
ARG NODE_ARCH=linux-arm64

RUN wget -O node.tar.xz https://nodejs.org/dist/v${NODE_VERSION}/node-v${NODE_VERSION}-${NODE_ARCH}.tar.xz && tar xf node.tar.xz
RUN mv node-v${NODE_VERSION}-${NODE_ARCH} node && rm node.tar.xz
ENV PATH="$PATH:/node/bin"

ENV DOTNET_CLI_TELEMETRY_OPTOUT=true


# Building the application

COPY . /build/
WORKDIR /build
RUN dotnet tool restore

RUN dotnet paket install